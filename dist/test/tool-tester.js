"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ToolTester = void 0;
class ToolTester {
    constructor() {
        this.results = [];
    }
    async runTest(tool, method, params) {
        const startTime = Date.now();
        const result = {
            tool,
            method,
            success: false,
            time: 0
        };
        try {
            const response = await Editor.Message.request(tool, method, params);
            result.success = true;
            result.result = response;
        }
        catch (error) {
            result.success = false;
            result.error = error instanceof Error ? error.message : String(error);
        }
        result.time = Date.now() - startTime;
        this.results.push(result);
        return result;
    }
    async testSceneOperations() {
        console.log('Testing Scene Operations...');
        // Test node creation (this is the main scene operation that works)
        const createResult = await this.runTest('scene', 'create-node', {
            name: 'TestNode',
            type: 'cc.Node'
        });
        if (createResult.success && createResult.result) {
            const nodeUuid = createResult.result;
            // Test query node info
            await this.runTest('scene', 'query-node-info', nodeUuid);
            // Test remove node
            await this.runTest('scene', 'remove-node', nodeUuid);
        }
        // Test execute scene script
        await this.runTest('scene', 'execute-scene-script', {
            name: 'cocos-mcp-server',
            method: 'test-method',
            args: []
        });
    }
    async testNodeOperations() {
        console.log('Testing Node Operations...');
        // Create a test node first
        const createResult = await this.runTest('scene', 'create-node', {
            name: 'TestNodeForOps',
            type: 'cc.Node'
        });
        if (createResult.success && createResult.result) {
            const nodeUuid = createResult.result;
            // Test set property
            await this.runTest('scene', 'set-property', {
                uuid: nodeUuid,
                path: 'position',
                dump: {
                    type: 'cc.Vec3',
                    value: { x: 100, y: 200, z: 0 }
                }
            });
            // Test add component
            await this.runTest('scene', 'add-component', {
                uuid: nodeUuid,
                component: 'cc.Sprite'
            });
            // Clean up
            await this.runTest('scene', 'remove-node', nodeUuid);
        }
    }
    async testAssetOperations() {
        console.log('Testing Asset Operations...');
        // Test asset list
        await this.runTest('asset-db', 'query-assets', {
            pattern: '**/*.png',
            ccType: 'cc.ImageAsset'
        });
        // Test query asset by path
        await this.runTest('asset-db', 'query-path', 'db://assets');
        // Test query asset by uuid (using a valid uuid format)
        await this.runTest('asset-db', 'query-uuid', 'db://assets');
    }
    async testProjectOperations() {
        console.log('Testing Project Operations...');
        // Test open project settings
        await this.runTest('project', 'open-settings', {});
        // Test query project settings
        const projectName = await this.runTest('project', 'query-setting', 'name');
        if (projectName.success) {
            console.log('Project name:', projectName.result);
        }
    }
    async runAllTests() {
        this.results = [];
        await this.testSceneOperations();
        await this.testNodeOperations();
        await this.testAssetOperations();
        await this.testProjectOperations();
        return this.getTestReport();
    }
    getTestReport() {
        const total = this.results.length;
        const passed = this.results.filter(r => r.success).length;
        const failed = total - passed;
        return {
            summary: {
                total,
                passed,
                failed,
                passRate: total > 0 ? (passed / total * 100).toFixed(2) + '%' : '0%'
            },
            results: this.results,
            grouped: this.groupResultsByTool()
        };
    }
    groupResultsByTool() {
        const grouped = {};
        for (const result of this.results) {
            if (!grouped[result.tool]) {
                grouped[result.tool] = [];
            }
            grouped[result.tool].push(result);
        }
        return grouped;
    }
}
exports.ToolTester = ToolTester;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbC10ZXN0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvdGVzdC90b29sLXRlc3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFXQSxNQUFhLFVBQVU7SUFBdkI7UUFDWSxZQUFPLEdBQWlCLEVBQUUsQ0FBQztJQTJKdkMsQ0FBQztJQXpKRyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQVksRUFBRSxNQUFjLEVBQUUsTUFBVztRQUNuRCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDN0IsTUFBTSxNQUFNLEdBQWU7WUFDdkIsSUFBSTtZQUNKLE1BQU07WUFDTixPQUFPLEVBQUUsS0FBSztZQUNkLElBQUksRUFBRSxDQUFDO1NBQ1YsQ0FBQztRQUVGLElBQUk7WUFDQSxNQUFNLFFBQVEsR0FBRyxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDcEUsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7WUFDdEIsTUFBTSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUM7U0FDNUI7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNaLE1BQU0sQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxLQUFLLEdBQUcsS0FBSyxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3pFO1FBRUQsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsU0FBUyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFCLE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFFRCxLQUFLLENBQUMsbUJBQW1CO1FBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLENBQUMsQ0FBQztRQUUzQyxtRUFBbUU7UUFDbkUsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxhQUFhLEVBQUU7WUFDNUQsSUFBSSxFQUFFLFVBQVU7WUFDaEIsSUFBSSxFQUFFLFNBQVM7U0FDbEIsQ0FBQyxDQUFDO1FBRUgsSUFBSSxZQUFZLENBQUMsT0FBTyxJQUFJLFlBQVksQ0FBQyxNQUFNLEVBQUU7WUFDN0MsTUFBTSxRQUFRLEdBQUcsWUFBWSxDQUFDLE1BQU0sQ0FBQztZQUVyQyx1QkFBdUI7WUFDdkIsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUV6RCxtQkFBbUI7WUFDbkIsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxhQUFhLEVBQUUsUUFBUSxDQUFDLENBQUM7U0FDeEQ7UUFFRCw0QkFBNEI7UUFDNUIsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsRUFBRTtZQUNoRCxJQUFJLEVBQUUsa0JBQWtCO1lBQ3hCLE1BQU0sRUFBRSxhQUFhO1lBQ3JCLElBQUksRUFBRSxFQUFFO1NBQ1gsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELEtBQUssQ0FBQyxrQkFBa0I7UUFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1FBRTFDLDJCQUEyQjtRQUMzQixNQUFNLFlBQVksR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLGFBQWEsRUFBRTtZQUM1RCxJQUFJLEVBQUUsZ0JBQWdCO1lBQ3RCLElBQUksRUFBRSxTQUFTO1NBQ2xCLENBQUMsQ0FBQztRQUVILElBQUksWUFBWSxDQUFDLE9BQU8sSUFBSSxZQUFZLENBQUMsTUFBTSxFQUFFO1lBQzdDLE1BQU0sUUFBUSxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUM7WUFFckMsb0JBQW9CO1lBQ3BCLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsY0FBYyxFQUFFO2dCQUN4QyxJQUFJLEVBQUUsUUFBUTtnQkFDZCxJQUFJLEVBQUUsVUFBVTtnQkFDaEIsSUFBSSxFQUFFO29CQUNGLElBQUksRUFBRSxTQUFTO29CQUNmLEtBQUssRUFBRSxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO2lCQUNsQzthQUNKLENBQUMsQ0FBQztZQUVILHFCQUFxQjtZQUNyQixNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLGVBQWUsRUFBRTtnQkFDekMsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsU0FBUyxFQUFFLFdBQVc7YUFDekIsQ0FBQyxDQUFDO1lBRUgsV0FBVztZQUNYLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsYUFBYSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1NBQ3hEO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxtQkFBbUI7UUFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1FBRTNDLGtCQUFrQjtRQUNsQixNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLGNBQWMsRUFBRTtZQUMzQyxPQUFPLEVBQUUsVUFBVTtZQUNuQixNQUFNLEVBQUUsZUFBZTtTQUMxQixDQUFDLENBQUM7UUFFSCwyQkFBMkI7UUFDM0IsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxZQUFZLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFFNUQsdURBQXVEO1FBQ3ZELE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsWUFBWSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFFRCxLQUFLLENBQUMscUJBQXFCO1FBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztRQUU3Qyw2QkFBNkI7UUFDN0IsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxlQUFlLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFbkQsOEJBQThCO1FBQzlCLE1BQU0sV0FBVyxHQUFHLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsZUFBZSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRTNFLElBQUksV0FBVyxDQUFDLE9BQU8sRUFBRTtZQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDcEQ7SUFDTCxDQUFDO0lBRUQsS0FBSyxDQUFDLFdBQVc7UUFDYixJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUVsQixNQUFNLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1FBQ2pDLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7UUFDaEMsTUFBTSxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUNqQyxNQUFNLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1FBRW5DLE9BQU8sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFFRCxhQUFhO1FBQ1QsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFDbEMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQzFELE1BQU0sTUFBTSxHQUFHLEtBQUssR0FBRyxNQUFNLENBQUM7UUFFOUIsT0FBTztZQUNILE9BQU8sRUFBRTtnQkFDTCxLQUFLO2dCQUNMLE1BQU07Z0JBQ04sTUFBTTtnQkFDTixRQUFRLEVBQUUsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUk7YUFDdkU7WUFDRCxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU87WUFDckIsT0FBTyxFQUFFLElBQUksQ0FBQyxrQkFBa0IsRUFBRTtTQUNyQyxDQUFDO0lBQ04sQ0FBQztJQUVPLGtCQUFrQjtRQUN0QixNQUFNLE9BQU8sR0FBaUMsRUFBRSxDQUFDO1FBRWpELEtBQUssTUFBTSxNQUFNLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUMvQixJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDdkIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7YUFDN0I7WUFDRCxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNyQztRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7Q0FDSjtBQTVKRCxnQ0E0SkMiLCJzb3VyY2VzQ29udGVudCI6WyJkZWNsYXJlIGNvbnN0IEVkaXRvcjogYW55O1xuXG5pbnRlcmZhY2UgVGVzdFJlc3VsdCB7XG4gICAgdG9vbDogc3RyaW5nO1xuICAgIG1ldGhvZDogc3RyaW5nO1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgcmVzdWx0PzogYW55O1xuICAgIGVycm9yPzogc3RyaW5nO1xuICAgIHRpbWU6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFRvb2xUZXN0ZXIge1xuICAgIHByaXZhdGUgcmVzdWx0czogVGVzdFJlc3VsdFtdID0gW107XG5cbiAgICBhc3luYyBydW5UZXN0KHRvb2w6IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhcmFtczogYW55KTogUHJvbWlzZTxUZXN0UmVzdWx0PiB7XG4gICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdDogVGVzdFJlc3VsdCA9IHtcbiAgICAgICAgICAgIHRvb2wsXG4gICAgICAgICAgICBtZXRob2QsXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIHRpbWU6IDBcbiAgICAgICAgfTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KHRvb2wsIG1ldGhvZCwgcGFyYW1zKTtcbiAgICAgICAgICAgIHJlc3VsdC5zdWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlc3VsdC5yZXN1bHQgPSByZXNwb25zZTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJlc3VsdC5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgICAgICByZXN1bHQuZXJyb3IgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcik7XG4gICAgICAgIH1cblxuICAgICAgICByZXN1bHQudGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICAgIHRoaXMucmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgYXN5bmMgdGVzdFNjZW5lT3BlcmF0aW9ucygpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1Rlc3RpbmcgU2NlbmUgT3BlcmF0aW9ucy4uLicpO1xuICAgICAgICBcbiAgICAgICAgLy8gVGVzdCBub2RlIGNyZWF0aW9uICh0aGlzIGlzIHRoZSBtYWluIHNjZW5lIG9wZXJhdGlvbiB0aGF0IHdvcmtzKVxuICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCB0aGlzLnJ1blRlc3QoJ3NjZW5lJywgJ2NyZWF0ZS1ub2RlJywge1xuICAgICAgICAgICAgbmFtZTogJ1Rlc3ROb2RlJyxcbiAgICAgICAgICAgIHR5cGU6ICdjYy5Ob2RlJ1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQucmVzdWx0KSB7XG4gICAgICAgICAgICBjb25zdCBub2RlVXVpZCA9IGNyZWF0ZVJlc3VsdC5yZXN1bHQ7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFRlc3QgcXVlcnkgbm9kZSBpbmZvXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnJ1blRlc3QoJ3NjZW5lJywgJ3F1ZXJ5LW5vZGUtaW5mbycsIG5vZGVVdWlkKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gVGVzdCByZW1vdmUgbm9kZVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5ydW5UZXN0KCdzY2VuZScsICdyZW1vdmUtbm9kZScsIG5vZGVVdWlkKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gVGVzdCBleGVjdXRlIHNjZW5lIHNjcmlwdFxuICAgICAgICBhd2FpdCB0aGlzLnJ1blRlc3QoJ3NjZW5lJywgJ2V4ZWN1dGUtc2NlbmUtc2NyaXB0Jywge1xuICAgICAgICAgICAgbmFtZTogJ2NvY29zLW1jcC1zZXJ2ZXInLFxuICAgICAgICAgICAgbWV0aG9kOiAndGVzdC1tZXRob2QnLFxuICAgICAgICAgICAgYXJnczogW11cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMgdGVzdE5vZGVPcGVyYXRpb25zKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnVGVzdGluZyBOb2RlIE9wZXJhdGlvbnMuLi4nKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBhIHRlc3Qgbm9kZSBmaXJzdFxuICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCB0aGlzLnJ1blRlc3QoJ3NjZW5lJywgJ2NyZWF0ZS1ub2RlJywge1xuICAgICAgICAgICAgbmFtZTogJ1Rlc3ROb2RlRm9yT3BzJyxcbiAgICAgICAgICAgIHR5cGU6ICdjYy5Ob2RlJ1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQucmVzdWx0KSB7XG4gICAgICAgICAgICBjb25zdCBub2RlVXVpZCA9IGNyZWF0ZVJlc3VsdC5yZXN1bHQ7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFRlc3Qgc2V0IHByb3BlcnR5XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnJ1blRlc3QoJ3NjZW5lJywgJ3NldC1wcm9wZXJ0eScsIHtcbiAgICAgICAgICAgICAgICB1dWlkOiBub2RlVXVpZCxcbiAgICAgICAgICAgICAgICBwYXRoOiAncG9zaXRpb24nLFxuICAgICAgICAgICAgICAgIGR1bXA6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NjLlZlYzMnLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogeyB4OiAxMDAsIHk6IDIwMCwgejogMCB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFRlc3QgYWRkIGNvbXBvbmVudFxuICAgICAgICAgICAgYXdhaXQgdGhpcy5ydW5UZXN0KCdzY2VuZScsICdhZGQtY29tcG9uZW50Jywge1xuICAgICAgICAgICAgICAgIHV1aWQ6IG5vZGVVdWlkLFxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ2NjLlNwcml0ZSdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDbGVhbiB1cFxuICAgICAgICAgICAgYXdhaXQgdGhpcy5ydW5UZXN0KCdzY2VuZScsICdyZW1vdmUtbm9kZScsIG5vZGVVdWlkKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHRlc3RBc3NldE9wZXJhdGlvbnMoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdUZXN0aW5nIEFzc2V0IE9wZXJhdGlvbnMuLi4nKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRlc3QgYXNzZXQgbGlzdFxuICAgICAgICBhd2FpdCB0aGlzLnJ1blRlc3QoJ2Fzc2V0LWRiJywgJ3F1ZXJ5LWFzc2V0cycsIHtcbiAgICAgICAgICAgIHBhdHRlcm46ICcqKi8qLnBuZycsXG4gICAgICAgICAgICBjY1R5cGU6ICdjYy5JbWFnZUFzc2V0J1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRlc3QgcXVlcnkgYXNzZXQgYnkgcGF0aFxuICAgICAgICBhd2FpdCB0aGlzLnJ1blRlc3QoJ2Fzc2V0LWRiJywgJ3F1ZXJ5LXBhdGgnLCAnZGI6Ly9hc3NldHMnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRlc3QgcXVlcnkgYXNzZXQgYnkgdXVpZCAodXNpbmcgYSB2YWxpZCB1dWlkIGZvcm1hdClcbiAgICAgICAgYXdhaXQgdGhpcy5ydW5UZXN0KCdhc3NldC1kYicsICdxdWVyeS11dWlkJywgJ2RiOi8vYXNzZXRzJyk7XG4gICAgfVxuXG4gICAgYXN5bmMgdGVzdFByb2plY3RPcGVyYXRpb25zKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnVGVzdGluZyBQcm9qZWN0IE9wZXJhdGlvbnMuLi4nKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFRlc3Qgb3BlbiBwcm9qZWN0IHNldHRpbmdzXG4gICAgICAgIGF3YWl0IHRoaXMucnVuVGVzdCgncHJvamVjdCcsICdvcGVuLXNldHRpbmdzJywge30pO1xuICAgICAgICBcbiAgICAgICAgLy8gVGVzdCBxdWVyeSBwcm9qZWN0IHNldHRpbmdzXG4gICAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gYXdhaXQgdGhpcy5ydW5UZXN0KCdwcm9qZWN0JywgJ3F1ZXJ5LXNldHRpbmcnLCAnbmFtZScpO1xuICAgICAgICBcbiAgICAgICAgaWYgKHByb2plY3ROYW1lLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQcm9qZWN0IG5hbWU6JywgcHJvamVjdE5hbWUucmVzdWx0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHJ1bkFsbFRlc3RzKCkge1xuICAgICAgICB0aGlzLnJlc3VsdHMgPSBbXTtcbiAgICAgICAgXG4gICAgICAgIGF3YWl0IHRoaXMudGVzdFNjZW5lT3BlcmF0aW9ucygpO1xuICAgICAgICBhd2FpdCB0aGlzLnRlc3ROb2RlT3BlcmF0aW9ucygpO1xuICAgICAgICBhd2FpdCB0aGlzLnRlc3RBc3NldE9wZXJhdGlvbnMoKTtcbiAgICAgICAgYXdhaXQgdGhpcy50ZXN0UHJvamVjdE9wZXJhdGlvbnMoKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzLmdldFRlc3RSZXBvcnQoKTtcbiAgICB9XG5cbiAgICBnZXRUZXN0UmVwb3J0KCkge1xuICAgICAgICBjb25zdCB0b3RhbCA9IHRoaXMucmVzdWx0cy5sZW5ndGg7XG4gICAgICAgIGNvbnN0IHBhc3NlZCA9IHRoaXMucmVzdWx0cy5maWx0ZXIociA9PiByLnN1Y2Nlc3MpLmxlbmd0aDtcbiAgICAgICAgY29uc3QgZmFpbGVkID0gdG90YWwgLSBwYXNzZWQ7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgICAgICAgIHRvdGFsLFxuICAgICAgICAgICAgICAgIHBhc3NlZCxcbiAgICAgICAgICAgICAgICBmYWlsZWQsXG4gICAgICAgICAgICAgICAgcGFzc1JhdGU6IHRvdGFsID4gMCA/IChwYXNzZWQgLyB0b3RhbCAqIDEwMCkudG9GaXhlZCgyKSArICclJyA6ICcwJSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXN1bHRzOiB0aGlzLnJlc3VsdHMsXG4gICAgICAgICAgICBncm91cGVkOiB0aGlzLmdyb3VwUmVzdWx0c0J5VG9vbCgpXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBncm91cFJlc3VsdHNCeVRvb2woKSB7XG4gICAgICAgIGNvbnN0IGdyb3VwZWQ6IFJlY29yZDxzdHJpbmcsIFRlc3RSZXN1bHRbXT4gPSB7fTtcbiAgICAgICAgXG4gICAgICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHRoaXMucmVzdWx0cykge1xuICAgICAgICAgICAgaWYgKCFncm91cGVkW3Jlc3VsdC50b29sXSkge1xuICAgICAgICAgICAgICAgIGdyb3VwZWRbcmVzdWx0LnRvb2xdID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBncm91cGVkW3Jlc3VsdC50b29sXS5wdXNoKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBncm91cGVkO1xuICAgIH1cbn0iXX0=